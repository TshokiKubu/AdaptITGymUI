import { StorageUtil, isBrowser } from './util';
const cache = {};
function WebStorage(storage, key, expiredAt = 0, expiredUnit = 'd') {
    return (target, propertyName) => {
        key = key || propertyName;
        Object.defineProperty(target, propertyName, {
            get: () => {
                return StorageUtil.get(storage, key);
            },
            set: (value) => {
                if (!cache[key]) {
                    const storedValue = StorageUtil.get(storage, key);
                    if (storedValue === null) {
                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                    }
                    cache[key] = true;
                    return;
                }
                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
            },
            enumerable: true,
            configurable: true,
        });
    };
}
/**
 * `localStorage` Decorator
 *
 * @param [expiredAt=0] Expiration time, 0 means forever
 * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])
 */
export function LocalStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(isBrowser ? localStorage : null, key, expiredAt, expiredUnit);
}
/**
 * `sessionStorage` Decorator
 *
 * @param [expiredAt=0] Expiration time, 0 means forever
 * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])
 */
export function SessionStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(isBrowser ? sessionStorage : null, key, expiredAt, expiredUnit);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3NyYy9kZWNvcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFlLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFLN0QsTUFBTSxLQUFLLEdBQVcsRUFBRSxDQUFDO0FBRXpCLFNBQVMsVUFBVSxDQUNqQixPQUF1QixFQUN2QixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sQ0FBQyxNQUFVLEVBQUUsWUFBb0IsRUFBUSxFQUFFO1FBQ2hELEdBQUcsR0FBRyxHQUFHLElBQUksWUFBWSxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFlBQVksRUFBRTtZQUMxQyxHQUFHLEVBQUUsR0FBRyxFQUFFO2dCQUNSLE9BQU8sV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBYSxDQUFDLENBQUM7WUFDakQsQ0FBQztZQUNELEdBQUcsRUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFO2dCQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQWEsQ0FBQyxFQUFFO29CQUN6QixNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFhLENBQUMsQ0FBQztvQkFDNUQsSUFBSSxXQUFXLEtBQUssSUFBSSxFQUFFO3dCQUN4QixXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFhLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztxQkFDeEU7b0JBQ0QsS0FBSyxDQUFDLEdBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQztvQkFDNUIsT0FBTztpQkFDUjtnQkFDRCxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFhLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUN6RSxDQUFDO1lBQ0QsVUFBVSxFQUFFLElBQUk7WUFDaEIsWUFBWSxFQUFFLElBQUk7U0FDbkIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVEOzs7OztHQUtHO0FBQ0gsTUFBTSxVQUFVLFlBQVksQ0FDMUIsR0FBWSxFQUNaLFlBQW9CLENBQUMsRUFDckIsY0FBMkIsR0FBRztJQUU5QixPQUFPLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDbEYsQ0FBQztBQUVEOzs7OztHQUtHO0FBQ0gsTUFBTSxVQUFVLGNBQWMsQ0FDNUIsR0FBWSxFQUNaLFlBQW9CLENBQUMsRUFDckIsY0FBMkIsR0FBRztJQUU5QixPQUFPLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDcEYsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV4cGlyZWRVbml0LCBTdG9yYWdlVXRpbCwgaXNCcm93c2VyIH0gZnJvbSAnLi91dGlsJztcblxuaW50ZXJmYWNlIElDYWNoZSB7XG4gIFtrZXk6IHN0cmluZ106IGJvb2xlYW47XG59XG5jb25zdCBjYWNoZTogSUNhY2hlID0ge307XG5cbmZ1bmN0aW9uIFdlYlN0b3JhZ2UoXG4gIHN0b3JhZ2U6IFN0b3JhZ2UgfCBudWxsLFxuICBrZXk/OiBzdHJpbmcsXG4gIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ2QnLFxuKTogKHRhcmdldDoge30sIHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB2b2lkIHtcbiAgcmV0dXJuICh0YXJnZXQ6IHt9LCBwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgIGtleSA9IGtleSB8fCBwcm9wZXJ0eU5hbWU7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlOYW1lLCB7XG4gICAgICBnZXQ6ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCBrZXkgYXMgc3RyaW5nKTtcbiAgICAgIH0sXG4gICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XG4gICAgICAgIGlmICghY2FjaGVba2V5IGFzIHN0cmluZ10pIHtcbiAgICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCBrZXkgYXMgc3RyaW5nKTtcbiAgICAgICAgICBpZiAoc3RvcmVkVmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIFN0b3JhZ2VVdGlsLnNldChzdG9yYWdlLCBrZXkgYXMgc3RyaW5nLCB2YWx1ZSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhY2hlW2tleSBhcyBzdHJpbmddID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgU3RvcmFnZVV0aWwuc2V0KHN0b3JhZ2UsIGtleSBhcyBzdHJpbmcsIHZhbHVlLCBleHBpcmVkQXQsIGV4cGlyZWRVbml0KTtcbiAgICAgIH0sXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIH0pO1xuICB9O1xufVxuXG4vKipcbiAqIGBsb2NhbFN0b3JhZ2VgIERlY29yYXRvclxuICpcbiAqIEBwYXJhbSBbZXhwaXJlZEF0PTBdIEV4cGlyYXRpb24gdGltZSwgMCBtZWFucyBmb3JldmVyXG4gKiBAcGFyYW0gW2V4cGlyZWRVbml0PSd0J10gRXhwaXJhdGlvbiB0aW1lIHVuaXQgKGRlZmF1bHQ6IGN1c3RvbSBbdW5pdDogbXNdKVxuICovXG5leHBvcnQgZnVuY3Rpb24gTG9jYWxTdG9yYWdlKFxuICBrZXk/OiBzdHJpbmcsXG4gIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ3QnLFxuKTogKHRhcmdldDoge30sIHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB2b2lkIHtcbiAgcmV0dXJuIFdlYlN0b3JhZ2UoaXNCcm93c2VyID8gbG9jYWxTdG9yYWdlIDogbnVsbCwga2V5LCBleHBpcmVkQXQsIGV4cGlyZWRVbml0KTtcbn1cblxuLyoqXG4gKiBgc2Vzc2lvblN0b3JhZ2VgIERlY29yYXRvclxuICpcbiAqIEBwYXJhbSBbZXhwaXJlZEF0PTBdIEV4cGlyYXRpb24gdGltZSwgMCBtZWFucyBmb3JldmVyXG4gKiBAcGFyYW0gW2V4cGlyZWRVbml0PSd0J10gRXhwaXJhdGlvbiB0aW1lIHVuaXQgKGRlZmF1bHQ6IGN1c3RvbSBbdW5pdDogbXNdKVxuICovXG5leHBvcnQgZnVuY3Rpb24gU2Vzc2lvblN0b3JhZ2UoXG4gIGtleT86IHN0cmluZyxcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxuICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXG4pOiAodGFyZ2V0OiB7fSwgcHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHZvaWQge1xuICByZXR1cm4gV2ViU3RvcmFnZShpc0Jyb3dzZXIgPyBzZXNzaW9uU3RvcmFnZSA6IG51bGwsIGtleSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XG59XG4iXX0=